var UploadToAli=function(e,t,a,o,i,s){"use strict";function r(e){r.installed||(r.installed=!0,e.component("UploadToAli",l))}t=t&&t.hasOwnProperty("default")?t.default:t,a=a&&a.hasOwnProperty("default")?a.default:a,o=o&&o.hasOwnProperty("default")?o.default:o,i=i&&i.hasOwnProperty("default")?i.default:i,s=s&&s.hasOwnProperty("default")?s.default:s,function(){if("undefined"!=typeof document){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),a=".upload-to-oss { display: inline-block; } .upload-to-oss .disabled { pointer-events: none; } .upload-to-oss .upload-item, .upload-to-oss .upload-box { display: inline-flex; justify-content: center; align-items: center; width: 80px; height: 80px; border-radius: 3px; border: 1px solid #cad1e8; } .upload-to-oss .upload-item:hover, .upload-to-oss .upload-box:hover { border-color: #5d81f9; } .upload-to-oss .is-preview:hover { cursor: zoom-in; } .upload-to-oss .upload-item { position: relative; margin: 0 8px 8px 0; } .upload-to-oss .upload-placeholder, .upload-to-oss .upload-loading { position: relative; width: 100%; height: 100%; text-align: center; } .upload-to-oss .upload-placeholder:before { width: 2px; height: 20px; background-color: #cad1e8; } .upload-to-oss .upload-placeholder:after { width: 20px; height: 2px; background-color: #cad1e8; } .upload-to-oss .upload-placeholder:before, .upload-to-oss .upload-placeholder:after, .upload-to-oss .upload-del-icon:before, .upload-to-oss .upload-del-icon:after, .upload-to-oss .upload-loading:before { content: ''; display: block; position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); } .upload-to-oss .upload-loading { background-color: rgba(255,255,255,0.9); border-radius: 3px; transition: opacity 0.3s; } .upload-to-oss .upload-loading .circular { position: absolute; left: 28%; top: 28%; height: 35px; width: 35px; -webkit-animation: is-loading 2s linear infinite; animation: is-loading 2s linear infinite; } .upload-to-oss .upload-loading .path { -webkit-animation: loading-dash 1.5s ease-in-out infinite; animation: loading-dash 1.5s ease-in-out infinite; stroke-dasharray: 90, 150; stroke-dashoffset: 0; stroke-width: 2; stroke: #5d81f9; stroke-linecap: round; } @-moz-keyframes is-loading { 100% { transform: rotate(360deg); } } @-webkit-keyframes is-loading { 100% { transform: rotate(360deg); } } @-o-keyframes is-loading { 100% { transform: rotate(360deg); } } @keyframes is-loading { 100% { transform: rotate(360deg); } } @-moz-keyframes loading-dash { 0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; } 50% { stroke-dasharray: 90, 150; stroke-dashoffset: -40px; } 100% { stroke-dasharray: 90, 150; stroke-dashoffset: -120px; } } @-webkit-keyframes loading-dash { 0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; } 50% { stroke-dasharray: 90, 150; stroke-dashoffset: -40px; } 100% { stroke-dasharray: 90, 150; stroke-dashoffset: -120px; } } @-o-keyframes loading-dash { 0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; } 50% { stroke-dasharray: 90, 150; stroke-dashoffset: -40px; } 100% { stroke-dasharray: 90, 150; stroke-dashoffset: -120px; } } @keyframes loading-dash { 0% { stroke-dasharray: 1, 200; stroke-dashoffset: 0; } 50% { stroke-dasharray: 90, 150; stroke-dashoffset: -40px; } 100% { stroke-dasharray: 90, 150; stroke-dashoffset: -120px; } } .upload-to-oss .upload-del-icon { position: absolute; right: -8px; top: -8px; width: 16px; height: 16px; background-color: #cad1e8; border-radius: 50%; line-height: 16px; transform: rotate(45deg); z-index: 1; cursor: pointer; } .upload-to-oss .upload-del-icon:before { width: 1px; height: 8px; background: #fff; } .upload-to-oss .upload-del-icon:after { width: 8px; height: 1px; background: #fff; } .upload-to-oss .upload-img { position: absolute; width: 100%; max-height: 100%; display: block; top: 50%; transform: translate(0, -50%); } .upload-to-oss .upload-input { display: none; } .upload-to-oss .upload-area { cursor: pointer; display: inline-block; } .upload-to-oss--highlight .upload-box { box-shadow: 0 0 0 1px #5d81f9; } ";t.type="text/css",t.styleSheet?t.styleSheet.cssText=a:t.appendChild(document.createTextNode(a)),e.appendChild(t)}}();var n=new s,l={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-to-oss",class:{"upload-to-oss--highlight":e.isHighlight},attrs:{title:"粘贴或拖拽即可上传图片"}},[e.$slots.default?e._e():e._l(e.uploadList,function(t,o){return a("div",{key:o,staticClass:"upload-item",class:{"is-preview":e.preview}},[e.disabled?e._e():a("i",{staticClass:"upload-del-icon",attrs:{title:"删除图片"},on:{click:function(a){a.stopPropagation(),a.preventDefault(),e.onDelete(t,o)}}}),e._v(" "),a("img",{staticClass:"upload-img",attrs:{src:t},on:{click:function(a){e.onClick(t)}}})])}),e._v(" "),e.canUpload?a("div",{staticClass:"upload-area",class:{disabled:e.disabled},on:{click:e.selectFiles,paste:e.paste,dragover:e.onDragover,dragleave:e.removeHighlight,drop:e.onDrop}},[e._t("default",[a("div",{staticClass:"upload-box"},[e.uploading?e._t("spinner",[a("div",{staticClass:"upload-loading"},[a("svg",{staticClass:"circular",attrs:{viewBox:"25 25 50 50"}},[a("circle",{staticClass:"path",attrs:{cx:"50",cy:"50",r:"20",fill:"none"}})])])]):e._t("placeholder",[a("div",{staticClass:"upload-placeholder"})])],2)])],2):e._e(),e._v(" "),a("input",{ref:"uploadInput",staticClass:"upload-input",attrs:{type:"file",hidden:"",disabled:e.uploading,accept:e.accept,multiple:e.multiple},on:{change:e.upload}}),e._v(" "),e.preview?a("img-preview",{model:{value:e.previewUrl,callback:function(t){e.previewUrl=t},expression:"previewUrl"}}):e._e()],2)},staticRenderFns:[],name:"UploadToAli",components:{ImgPreview:i},props:{accessKeyId:{type:String,default:process.env.OSS_KEY},accessKeySecret:{type:String,default:process.env.OSS_SECRET},bucket:{type:String,default:process.env.OSS_BUCKET},region:{type:String,default:process.env.OSS_REGION},dir:{type:String,default:process.env.OSS_DIR||""},customDomain:{type:String,default:process.env.OSS_CUSTOM_DOMAIN},value:[String,Array],multiple:{type:Boolean,default:!1},size:{type:Number,default:1024},accept:{type:String,default:"image/png, image/jpeg, image/gif, image/jpg"},timeout:{type:Number,default:0},disabled:{type:Boolean,default:!1},max:{type:Number,default:9,validator:function(e){return e>0}},compressOptions:{type:Object,default:function(){return{maxWidth:750}}},uploadOptions:{type:Object,default:function(){return{partSize:102400}}},preview:{type:Boolean,default:!0},onClick:{type:Function,default:function(e){this.previewUrl=e}}},data:function(){return{client:{},previewUrl:"",uploading:!1,isHighlight:!1}},computed:{uploadList:function(){return[].concat(this.value).filter(function(e){return!!e})},canUpload:function(){var e=this.multiple?this.max:1;return this.uploadList.length<e}},mounted:function(){if(!(this.region&&this.bucket&&this.accessKeyId&&this.accessKeySecret))return void console.error("必要参数不能为空: region bucket accessKeyId accessKeySecret");this.newClient()},methods:{newClient:function(){this.client=new o({region:this.region,bucket:this.bucket,accessKeyId:this.accessKeyId,accessKeySecret:this.accessKeySecret})},onDelete:function(e,t){var a=this.multiple?this.uploadList.filter(function(t){return t!==e}):"";this.$emit("input",a),this.$emit("delete",e,t)},selectFiles:function(){if(!this.canUpload)return void alert("已达到上传的最大数量");this.$refs.uploadInput.click()},upload:function(){function e(e){return o.apply(this,arguments)}var o=a(t.mark(function e(a){var o,i,s,r,l,d,u,p,c,h,f=this,g=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"target";return t.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.loading){e.next=2;break}return e.abrupt("return");case 2:if(o=Array.from(a[g].files),i=[],o.length){e.next=6;break}return e.abrupt("return");case 6:if(!o.some(function(e){return e.size>1024*f.size})){e.next=9;break}return alert("请选择"+this.size+"KB内的文件！"),e.abrupt("return");case 9:if(!o.some(function(e){return-1===f.accept.indexOf(e.type)})){e.next=12;break}return alert("文件格式有误！"),e.abrupt("return");case 12:s=function(){return a.target.value=""},this.uploading=!0,r=this.multiple?this.max:1,l=0;case 16:if(!(l<o.length)){e.next=37;break}if(this.uploadList.length!==r){e.next=19;break}return e.abrupt("break",37);case 19:if(d=o[l],u=d.name,p="",this.$emit("loading",u),!(d.type.indexOf("image")>-1)){e.next=27;break}return e.next=26,n.compress(d,this.compressOptions);case 26:d=e.sent;case 27:return c=u.lastIndexOf("."),h="",-1!=c&&(h=u.substring(c)),p=u.substring(0,c)+"-"+(new Date).getTime()+h,e.next=33,this.client.multipartUpload(this.dir+p,d,this.uploadOptions).then(function(e){var t="//";f.customDomain?f.customDomain.indexOf("//")>-1?t=f.customDomain+"/"+e.name:t+=f.customDomain+"/"+e.name:t+=f.bucket+"."+f.region+".aliyuncs.com/"+e.name,f.$emit("input",f.multiple?f.uploadList.concat(t):t),i.push(t)}).catch(function(e){s(),f.uploading=!1,"ConnectionTimeoutError"===a.code&&f.$emit("timeout"),f.client.isCancel()?f.$emit("cancel"):f.$emit("fail")});case 33:this.newClient();case 34:l++,e.next=16;break;case 37:if(s(),this.uploading=!1,!(i.length<1)){e.next=41;break}return e.abrupt("return");case 41:this.multiple?this.$emit("loaded",i):this.$emit("loaded",i[0]);case 42:case"end":return e.stop()}},e,this)}));return e}(),paste:function(e){var t=e.clipboardData&&e.clipboardData.files;t&&t.length&&this.upload(e,"clipboardData")},onDragover:function(e){e.preventDefault(),this.addHighlight()},onDrop:function(e){e.preventDefault(),this.removeHighlight();var t=e.dataTransfer&&e.dataTransfer.files;t&&t.length&&this.upload(e,"dataTransfer")},addHighlight:function(){this.isHighlight=!0},removeHighlight:function(){this.isHighlight=!1}}},d={install:r},u=null;return"undefined"!=typeof window?u=window.Vue:"undefined"!=typeof global&&(u=global.Vue),u&&u.use(d),e.install=r,e.default=l,e}({},_regeneratorRuntime,_asyncToGenerator,AliOSS,ImgPreview,ImageCompressor);
